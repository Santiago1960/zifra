import 'package:serverpod/serverpod.dart';
import '../generated/protocol.dart';

class CategoryEndpoint extends Endpoint {
  
  /// Obtiene todas las categorías de un usuario específico.
  /// Como no hay auth, el cliente debe enviar el userId.
  Future<List<Category>> getCategories(Session session, int userId) async {
    return await Category.db.find(
      session,
      where: (t) => t.userId.equals(userId),
      orderBy: (t) => t.name,
    );
  }

  /// Crea una nueva categoría.
  Future<void> addCategory(Session session, Category category) async {
    // Asumimos que el objeto 'category' ya viene con el userId correcto desde el cliente.
    await Category.db.insertRow(session, category);
  }

  /// Actualiza una categoría existente.
  Future<void> updateCategory(Session session, Category category) async {
    await Category.db.updateRow(session, category);
  }

  /// Elimina una categoría por su ID.
  Future<void> deleteCategory(Session session, int id) async {
    await Category.db.deleteWhere(session, where: (t) => t.id.equals(id));
  }
}